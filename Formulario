import tkinter as tk
from tkinter import ttk, filedialog, messagebox

def open_win_form(parent: tk.Tk):
    win = tk.Toplevel(parent)
    win.title("Reporte de Basura Marina")
    win.geometry("500x400")
    win.configure(bg="#e6f7ff")

    frm = ttk.Frame(win, padding=20)
    frm.pack(fill="both", expand=True)

    # Etiqueta de encabezado
    lbl_titulo = ttk.Label(frm, text="🌊 Nuevo Reporte de Basura", font=("Arial", 14, "bold"))
    lbl_titulo.grid(row=0, column=0, columnspan=2, pady=(0, 15))

    # Campo: ubicación
    ttk.Label(frm, text="Ubicación:").grid(row=1, column=0, sticky="w", pady=4)
    ent_ubicacion = ttk.Entry(frm, width=35)
    ent_ubicacion.grid(row=1, column=1, pady=4, sticky="w")

    # Campo: tipo de desecho
    ttk.Label(frm, text="Tipo de desecho:").grid(row=2, column=0, sticky="w", pady=4)
    cmb_tipo = ttk.Combobox(frm, values=["Botella", "Bolsa", "Red", "Taparrosca", "Otro"], width=32)
    cmb_tipo.grid(row=2, column=1, pady=4, sticky="w")

    # Campo: descripción
    ttk.Label(frm, text="Descripción:").grid(row=3, column=0, sticky="nw", pady=4)
    txt_desc = tk.Text(frm, width=34, height=5)
    txt_desc.grid(row=3, column=1, pady=4, sticky="w")

    # Cargar foto
    foto_path = tk.StringVar()

    def seleccionar_foto():
        ruta = filedialog.askopenfilename(filetypes=[("Imágenes", "*.jpg *.png *.jpeg")])
        if ruta:
            foto_path.set(ruta)
            messagebox.showinfo("Imagen seleccionada", f"Foto cargada:\n{ruta}")

    ttk.Button(frm, text="Cargar Foto", command=seleccionar_foto)\
        .grid(row=4, column=0, pady=8)

    # Guardar reporte
    def guardar_reporte():
        ubicacion = ent_ubicacion.get().strip()
        tipo = cmb_tipo.get().strip()
        descripcion = txt_desc.get("1.0", "end").strip()
        foto = foto_path.get()

        if not ubicacion or not tipo:
            messagebox.showerror("Error", "Por favor completa al menos ubicación y tipo de desecho.")
            return

        ruta = filedialog.asksaveasfilename(defaultextension=".txt",
                                            filetypes=[("Archivo de texto", "*.txt")])
        if ruta:
            with open(ruta, "w", encoding="utf-8") as f:
                f.write(f"🌊 REPORTE DE BASURA MARINA\n")
                f.write(f"Ubicación: {ubicacion}\n")
                f.write(f"Tipo de desecho: {tipo}\n")
                f.write(f"Descripción: {descripcion}\n")
                if foto:
                    f.write(f"Foto: {foto}\n")
            messagebox.showinfo("OK", "Reporte guardado con éxito.")

    # Botones
    ttk.Button(frm, text="Guardar Reporte", command=guardar_reporte)\
        .grid(row=5, column=0, pady=12)
    ttk.Button(frm, text="Cerrar", command=win.destroy)\
        .grid(row=5, column=1, sticky="e", pady=12)

# Ejemplo de ejecución independiente
if __name__ == "__main__":
    root = tk.Tk()
    root.withdraw()  # Oculta la ventana principal
    open_win_form(root)
    root.mainloop()
